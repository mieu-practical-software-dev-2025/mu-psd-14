# テスト仕様書: Flask + OpenRouter AI チャットアプリ

## 1. テスト対象
- `app.py` (Flaskサーバー/APIバックエンド)
- `static/index.html` (Vue.js フロントエンド)

## 2. テスト環境
- Windows 10/11
- Python 3.8以降
- Flask, openai, python-dotenv
- OpenRouter APIキー設定済み
- Webブラウザ: Chrome, Edge, Firefox 等

## 3. テスト項目

### 3.1. サーバー起動・静的ファイル配信
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 1  | サーバー起動 | コマンドプロンプトで `python app.py` を実行する。 | エラーなくサーバーが起動し、`http://localhost:5000/` でリッスンしている旨のメッセージが表示される。 |
| 2  | index.html配信 | ブラウザで `http://localhost:5000/` にアクセスする。 | 「専門用語解説」というタイトルを持つWebページが表示される。 |

### 3.2. /send_api API 正常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 3  | 解説リクエスト（子供向け） | テキストエリアに「機械学習」と入力し、「子供向け」ボタンをクリックする。 | 1. APIに `text: "機械学習"` と子供向けの `context` を含むJSONがPOSTされる。<br>2. ステータスコード200が返る。<br>3. レスポンスJSONに `processed_text` と `links` が含まれる。 |
| 4  | 解説リクエスト（大人向け） | テキストエリアに「ブロックチェーン」と入力し、「大人向け」ボタンをクリックする。 | 1. APIに `text: "ブロックチェーン"` と大人向けの `context` を含むJSONがPOSTされる。<br>2. ステータスコード200が返る。<br>3. レスポンスJSONに `processed_text` と `links` が含まれる。 |
| 5  | 関連語句リクエスト | テキストエリアに「量子コンピュータ」と入力し、「関連語句」ボタンをクリックする。 | 1. APIに `text: "量子コンピュータ"` と関連語句向けの `context` を含むJSONがPOSTされる。<br>2. ステータスコード200が返る。<br>3. レスポンスJSONに `processed_text` が含まれる。 |

### 3.3. /send_api API 異常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 6  | 空のテキストでリクエスト | テキストエリアを空のまま、いずれかのボタンをクリックする。 | 1. APIからステータスコード400が返る。<br>2. レスポンスJSONに `error: "Input text cannot be empty"` が含まれる。 |
| 7  | `text`フィールドなしでAPIコール | 開発者ツール等で `text` フィールドを含まないJSONを `/send_api` にPOSTする。 | 1. APIからステータスコード400が返る。<br>2. レスポンスJSONに `error: "Missing 'text' in request body"` が含まれる。 |
| 8  | APIキー未設定でサーバー起動 | `.env` ファイルから `OPENROUTER_API_KEY` の設定を削除またはコメントアウトして `python app.py` を実行し、APIを呼び出す。 | 1. APIからステータスコード500が返る。<br>2. レスポンスJSONに `error: "OpenRouter API key is not configured on the server."` が含まれる。 |
| 9  | AIからの応答が空の場合 | (要モック) `app.py` を修正し、AIからの応答が空になるようにシミュレートする。 | レスポンスJSONに `processed_text: "AIから有効な応答がありませんでした。"` が含まれて返る。 |
| 10 | AIサービスとの通信エラー | (要モック) `app.py` を修正し、AIへのAPIコールで例外が発生するようにシミュレートする。 | 1. APIからステータスコード500が返る。<br>2. レスポンスJSONに `error: "AIサービスとの通信中にエラーが発生しました。"` が含まれる。 |

### 3.4. UIテスト
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 11 | 正常な応答の表示 | 「子供向け」ボタンをクリックし、正常な応答が返ってくる。 | 1. 「解説」エリアにAIからの応答テキストが表示される。<br>2. 「参考リンク」エリアにWikipediaとYouTubeへのリンクが表示される。<br>3. 「関連する語句」エリアは「処理中...」から元の表示に戻る。 |
| 12 | 関連語句の表示 | 「関連語句」ボタンをクリックし、正常な応答が返ってくる。 | 1. 「関連する語句」エリアにAIからの応答テキストが表示される。<br>2. 「解説」「参考リンク」エリアは変更されない。 |
| 13 | エラーメッセージの表示 | APIからエラーが返ってくる（No.6 や No.8 のケース）。 | エラーの原因となった操作に応じて、「解説」または「関連する語句」のエリアに "エラー: ..." という形式のメッセージが表示され、背景が赤くなる。 |
| 14 | 読み上げ機能 | 「子供向け」または「大人向け」ボタンで解説を表示させた後、「読み上げ」ボタンをクリックする。 | 「解説」エリアに表示されているテキストが音声で読み上げられる。再度クリックすると、前の読み上げがキャンセルされて新しい読み上げが始まる。 |
| 15 | 処理中の表示 | いずれかのボタンをクリックする。 | APIからの応答を待っている間、対応するエリア（「解説」または「関連する語句」）に「処理中...」と表示される。 |

## 4. その他
- 各ブラウザ（Chrome, Edge, Firefox）での基本的な動作確認。
- レスポンスタイムの体感速度の確認。

---
